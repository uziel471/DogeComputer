create database cartbasic1;
use cartbasic1;

----INSERTS DE PRODUCTOS
--Auriculares
insert into comproductos (ProdNombre,ProdPrecio, ProdImagen, ProdCantidad, ProdDescontinuado, ProdProveedor, ProdModelo, ProdCategoria) value ('Headset Gamer', 60, 'he1.jpg',1000, 'C', 1, 'ONIKUMA',2);
insert into comproductos (ProdNombre,ProdPrecio, ProdImagen, ProdCantidad, ProdDescontinuado, ProdProveedor, ProdModelo, ProdCategoria) value ('Gaming Headset', 80, 'he2.jpg',1000, 'C', 2, 'G233 Prodigy',2);
insert into comproductos (ProdNombre,ProdPrecio, ProdImagen, ProdCantidad, ProdDescontinuado, ProdProveedor, ProdModelo, ProdCategoria) value ('Turtle Headset', 120, 'he3.jpg',1000, 'C', 3, 'Stealth 300',2);
insert into comproductos (ProdNombre,ProdPrecio, ProdImagen, ProdCantidad, ProdDescontinuado, ProdProveedor, ProdModelo, ProdCategoria) value ('KOTION Headset', 60, 'he4.jpg',1000, 'C', 4, 'Each g9000',2);
insert into comproductos (ProdNombre,ProdPrecio, ProdImagen, ProdCantidad, ProdDescontinuado, ProdProveedor, ProdModelo, ProdCategoria) value ('Headset Sentey', 70, 'he5.jpg',1000, 'C', 5, 'Sentey Huntex',2);

--Computadoras
insert into comproductos (ProdNombre,ProdPrecio, ProdImagen, ProdCantidad, ProdDescontinuado, ProdProveedor, ProdModelo, ProdCategoria) value ('Pc Gamer Orion', 30000, 'co1.jpg',1000,'C', 6, 'OrionX',1);
insert into comproductos (ProdNombre,ProdPrecio, ProdImagen, ProdCantidad, ProdDescontinuado, ProdProveedor, ProdModelo, ProdCategoria) value ('Barracuda', 700, 'co2.jpg',1000, 'C', 7, 'Barracuda Xtreme',1);
insert into comproductos (ProdNombre,ProdPrecio, ProdImagen, ProdCantidad, ProdDescontinuado, ProdProveedor, ProdModelo, ProdCategoria) value ('Elite Gaming PC Desktop', 950, 'co3.jpg',1000, 'C', 8, 'Computer Slate2 080i',1);
insert into comproductos (ProdNombre,ProdPrecio, ProdImagen, ProdCantidad, ProdDescontinuado, ProdProveedor, ProdModelo, ProdCategoria) value ('Enthusiast Gaming Computer', 1200, 'co4.jpg',1000, 'C', 8, 'AM010A AMD FX-6300',1);
insert into comproductos (ProdNombre,ProdPrecio, ProdImagen, ProdCantidad, ProdDescontinuado, ProdProveedor, ProdModelo, ProdCategoria) value ('PC GAMING VIBOX', 550, 'co5.jpg',1000, 'C', 9, 'Warrior 7',1);


--Tarjetas madre
insert into comproductos (ProdNombre,ProdPrecio, ProdImagen, ProdCantidad, ProdDescontinuado, ProdProveedor, ProdModelo, ProdCategoria) value ('Godlike Gaming', 550, 'ta1.jpg',1000, 'C', 10, 'x99a',3);
insert into comproductos (ProdNombre,ProdPrecio, ProdImagen, ProdCantidad, ProdDescontinuado, ProdProveedor, ProdModelo, ProdCategoria) value ('Tarjeta Madre Gamer Gigabyte', 250, 'ta2.jpg', 1000,'C', 11, 'Z270x',3);
insert into comproductos (ProdNombre,ProdPrecio, ProdImagen, ProdCantidad, ProdDescontinuado, ProdProveedor, ProdModelo, ProdCategoria) value ('Motherboard Mining', 200, 'ta3.jpg',1000, 'C', 12, 'b250-fintech',3);
insert into comproductos (ProdNombre,ProdPrecio, ProdImagen, ProdCantidad, ProdDescontinuado, ProdProveedor, ProdModelo, ProdCategoria) value ('ASUS Rog', 600, 'ta4.jpg',1000, 'C', 13, 'zenith extreme x399',3);
insert into comproductos (ProdNombre,ProdPrecio, ProdImagen, ProdCantidad, ProdDescontinuado, ProdProveedor, ProdModelo, ProdCategoria) value ('ASUS Rog Strix', 200, 'ta5.jpg',1000, 'C', 13, 'Z370-H',3);


--Tarjetas de video
insert into comproductos (ProdNombre,ProdPrecio, ProdImagen, ProdCantidad, ProdDescontinuado, ProdProveedor, ProdModelo, ProdCategoria) value ('Gigabyte Geforce', 250, 'tv1.jpg',1000,'C', 14, 'GTX 1050 Ti',4);
insert into comproductos (ProdNombre,ProdPrecio, ProdImagen, ProdCantidad, ProdDescontinuado, ProdProveedor, ProdModelo, ProdCategoria) value ('AORUS Geforce', 400, 'tv2.jpg', 1000,'C', 14, 'RTX 1060',4);
insert into comproductos (ProdNombre,ProdPrecio, ProdImagen, ProdCantidad, ProdDescontinuado, ProdProveedor, ProdModelo, ProdCategoria) value ('Asus ROG Strix', 500, 'tv3.jpg',1000, 'C', 13, 'GTX 1060',4);
insert into comproductos (ProdNombre,ProdPrecio, ProdImagen, ProdCantidad, ProdDescontinuado, ProdProveedor, ProdModelo, ProdCategoria) value ('Gigabyte Geforce', 200, 'tv4.jpg', 1000,'C', 14, 'GTX 750 Ti ',4);
insert into comproductos (ProdNombre,ProdPrecio, ProdImagen, ProdCantidad, ProdDescontinuado, ProdProveedor, ProdModelo, ProdCategoria) value ('Gigabyte Geforce', 1300, 'tv5.jpg', 1000,'C', 14, 'RTX 2080 ',4);


--Discos duros
insert into comproductos (ProdNombre,ProdPrecio, ProdImagen, ProdCantidad, ProdDescontinuado, ProdProveedor, ProdModelo, ProdCategoria) value ('Seagate hard drive', 60, 'dd1.jpg',1000, 'C', 15, 'Firecuda',5);
insert into comproductos (ProdNombre,ProdPrecio, ProdImagen, ProdCantidad, ProdDescontinuado, ProdProveedor, ProdModelo, ProdCategoria) value ('KINGSTON Hyper X', 40, 'dd2.jpg', 1000,'C', 16, 'Fury',5);
insert into comproductos (ProdNombre,ProdPrecio, ProdImagen, ProdCantidad, ProdDescontinuado, ProdProveedor, ProdModelo, ProdCategoria) value ('KINGSTON Hyper X', 50, 'dd3.jpg',1000, 'C', 16, 'Savage SSD',5);
insert into comproductos (ProdNombre,ProdPrecio, ProdImagen, ProdCantidad, ProdDescontinuado, ProdProveedor, ProdModelo, ProdCategoria) value ('SanDisk hard drive', 150, 'dd4.jpg',1000, 'C', 17, 'SSD Plus',5);
insert into comproductos (ProdNombre,ProdPrecio, ProdImagen, ProdCantidad, ProdDescontinuado, ProdProveedor, ProdModelo, ProdCategoria) value ('Samsung hard drive', 150, 'dd5.jpg',1000, 'C', 18, '860 evo',5);


--Procesadores
insert into comproductos (ProdNombre,ProdPrecio, ProdImagen, ProdCantidad, ProdDescontinuado, ProdProveedor, ProdModelo, ProdCategoria) value ('Intel Core', 400, 'pr1.jpg',1000, 'C', 19, 'i7-7700K',6);
insert into comproductos (ProdNombre,ProdPrecio, ProdImagen, ProdCantidad, ProdDescontinuado, ProdProveedor, ProdModelo, ProdCategoria) value ('Intel Core', 250, 'pr2.jpg',1000, 'C', 19, 'i5-9600K',6);
insert into comproductos (ProdNombre,ProdPrecio, ProdImagen, ProdCantidad, ProdDescontinuado, ProdProveedor, ProdModelo, ProdCategoria) value ('Intel Core', 520, 'pr3.jpg',1000, 'C', 19, 'i9-9900K',6);
insert into comproductos (ProdNombre,ProdPrecio, ProdImagen, ProdCantidad, ProdDescontinuado, ProdProveedor, ProdModelo, ProdCategoria) value ('Ryzen', 250, 'pr4.jpg',1000, 'C', 20, 'Ryzen 7 2700 X',6);
insert into comproductos (ProdNombre,ProdPrecio, ProdImagen, ProdCantidad, ProdDescontinuado, ProdProveedor, ProdModelo, ProdCategoria) value ('Ryzen', 130, 'pr5.jpg',1000, 'C', 20, 'Ryzen 5 2600 ',6);

----INSERTS DE PROVEEDORES
insert into ComProveedores (ProvNombre) value('PlayStation');
insert into ComProveedores (ProvNombre) value('Logitech');		
insert into ComProveedores (ProvNombre) value('Turtle beach');
insert into ComProveedores (ProvNombre) value('KOTION');
insert into ComProveedores (ProvNombre) value('Sentey');
insert into ComProveedores (ProvNombre) value('8Pack');
insert into ComProveedores (ProvNombre) value('WePC');
insert into ComProveedores (ProvNombre) value('iBUYPOWER');
insert into ComProveedores (ProvNombre) value('VIBOX');
insert into ComProveedores (ProvNombre) value('MSI');
insert into ComProveedores (ProvNombre) value('AORUS');
insert into ComProveedores (ProvNombre) value('Gigabyte');
insert into ComProveedores (ProvNombre) value('ASUS');
insert into ComProveedores (ProvNombre) value('NVIDIA');
insert into ComProveedores (ProvNombre) value('Seagate');
insert into ComProveedores (ProvNombre) value('Hyper X');
insert into ComProveedores (ProvNombre) value('SanDisk');
insert into ComProveedores (ProvNombre) value('SAMSUNG');
insert into ComProveedores (ProvNombre) value('Intel');
insert into ComProveedores (ProvNombre) value('AMD');

----INSERTS DE CATEGORIA

insert into ComCategorias(CatNombre) value('Computadoras');
insert into ComCategorias(CatNombre) value('Audiculares');
insert into ComCategorias(CatNombre) value('Tarjetas Madres');
insert into ComCategorias(CatNombre) value('Tarjetas De Video');
insert into ComCategorias(CatNombre) value('Discos Duros');
insert into ComCategorias(CatNombre) value('Procesadores');

$products = $con->query("select ProdNombre,ProdPrecio,ProdImagen,ProvNombre,MarNombre,ModNombre 
from comproductos pr join ComProveedores p on pr.ProdProveedor=p.ProvId join ComModelo  m
on pr.ProdModelo=m.ModId join ComMarca ma on ma.MarId=m.ModMarca ");


create table  ComContactanos
(
	Contid int  primary key auto_increment,
	ContNombre varchar(80) not null ,
	ContCorreo  varchar(80)not null,
	ContMotivo varchar (200) not null,
	ContMensaje varchar(200) not null
);

create table ComProveedores
(
		ProvId int  primary key auto_increment,
		ProvNombre varchar(50) not null			
);
create table ComCategorias
(
	CatId int  primary key auto_increment,
	CatNombre varchar(50)
	
);

create table ComProductos 
(
	id int primary key auto_increment, 
	ProdNombre varchar (50) not null, 
	ProdPrecio float not null, 
	ProdImagen varchar(20),
	ProdCantidad int not null,
	ProdDescontinuado char (1), 
	ProdProveedor int references ComProveedores (ProvId),
	ProdModelo varchar(50) not null,
	ProdCategoria int references ComCategorias (CatId)
);

create table ComUsuarios
(
	Usid int not null auto_increment primary key,
	UsNombre varchar(50)not null,
	UsApellidos varchar(70)not null,
	UsCorreo varchar(100)not null,
	UsContrasena varchar(20),
	UsContrasena2 varchar(20)
);

create table ComVentas
(
  VenId   int primary key auto_increment,
  VenUsuario int not null references ComUsuarios(Usid),
  VenFecha date not null,
  VenTotal double not null
);


create table ComDetVent
(
  VenID int references ComVentas(VenId),
  DetVenIdProd int not null references ComProductos(id),
  DetVentCat int not null,
  DetVentPrecio double not null
);

----prueba de inserciones par acarrito

insert into comventas (VenUsuario,VenFecha,VenTotal) values(1,CURDATE(),0);


-----ver ultimo registro de una tabla
select max(VenId)  ultventa from comventas;



----insert detalle ventas


---aqui es donde va el ciclo 
set @var1=1;

insert into ComDetVent (VenID,DetVenIdProd,DetVentCat,DetVentPrecio)  values(@var1,1,4,60);


-----otra forma
forech(){
 set @var1=(select max(VenId) from comventas);
 insert into ComDetVent (VenID,DetVenIdProd,DetVentCat,DetVentPrecio)  values(@var1,1,4,60);
 }
 
 
 -----triger stock
 create TRIGGER stock AFTER INSERT on ComDetVent
FOR EACH ROW
UPDATE ComProductos SET ProdCantidad=ProdCantidad-NEW.DetVentCat WHERE id = New.DetVenIdProd;
 


